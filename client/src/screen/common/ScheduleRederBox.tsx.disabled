import React, { useEffect, useState, useRef, useMemo, useCallback } from 'react'
import './ScheduleRederBox.scss'
import { DropdownBox } from '../../../boxs/DropdownBox';
import axios from 'axios';
import { AdminURL } from '../../../MainURL';
import { ImLocation } from 'react-icons/im';
import { TiArrowSortedUp, TiArrowSortedDown } from "react-icons/ti";
import RatingBoard from '../../common/RatingBoard';
import { useRecoilValue } from 'recoil';
import { recoilExchangeRate } from '../../../RecoilStore';
import { fetchScheduleDetailDataExternal } from './ScheduleDetailRedering';


interface ModalScheduleDetailProps {
    airlineData: {
      sort: string;
      airlineCode: string[];
    },
    scheduleDetailData: {
      breakfast :string;
      lunch:string;
      dinner :string;
      hotel:string;
      score:string;
      scheduleDetail: {
        id:number, 
        sort:string,
        st?: string,
        isViewLocation:boolean,
        locationIcon?: string,
        location:string, 
        isUseContent:boolean,
        locationContent?: string,
        locationDetail:{
          subLocation:string, 
          isUseContent:boolean,
          subLocationContent:string, 
          subLocationDetail:number[]}[]
        airlineData?: {
          airlineCode: string;
          airlineName: string;
          depart: string;
          departTime: string;
          arrive: string;
          arriveTime: string;
          addDay: string;
          id?: string;
        } | null;
        trainData?: {
          trainCode: string;
          trainName: string;
          depart: string;
          departTime: string;
          arrive: string;
          arriveTime: string;
          addDay: string;
          id?: string;
        } | null;
        busData?: {
          busCode: string;
          busName: string;
          depart: string;
          departTime: string;
          arrive: string;
          arriveTime: string;
          addDay: string;
          id?: string;
        } | null;
        shipData?: {
          shipCode: string;
          shipName: string;
          depart: string;
          departTime: string;
          arrive: string;
          arriveTime: string;
          addDay: string;
          id?: string;
        } | null;
      }[];
    }[]
  }
  

export default function ScheduleRederBox (props : any) {
	
  const url = new URL(window.location.href);
  const ID = url.searchParams.get("id");
  const [mainTab, setMainTab] = useState<string>('ì¼ì •ë¯¸ë¦¬ë³´ê¸°');
  
  const fetchScheduleData = async () => {
  

    try {
      setLoading(true);
      const response = await fetch(`${AdminURL}/ceylontour/getschedulebyid/4`);

      const data = await response.json();
      const scheduleData = data[0];

      try {
        await fetchScheduleDetailData(scheduleData);
      } catch (detailError) {
        console.error('ìƒì„¸ ë°ì´í„° ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', detailError);
        // ì—ëŸ¬ê°€ ë°œìƒí•´ë„ ê¸°ë³¸ êµ¬ì¡°ëŠ” ì„¤ì •
        const defaultSchedule = {
          airlineData: { sort: '', airlineCode: [] },
          scheduleDetailData: [createEmptyDay()]
        };
        setScheduleList([defaultSchedule]);
      }
      
    } catch (error) {
      console.error('ìŠ¤ì¼€ì¤„ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
      // ì—ëŸ¬ ë°œìƒ ì‹œì—ë„ ê¸°ë³¸ êµ¬ì¡° ì„¤ì •
      const defaultSchedule = {
        airlineData: { sort: '', airlineCode: [] },
        scheduleDetailData: [createEmptyDay()]
      };
      setScheduleList([defaultSchedule]);
    } finally {
      // fetchScheduleDetailDataê°€ ì™„ì „íˆ ëë‚œ í›„ì—ë§Œ ë¡œë”© í•´ì œ
      setLoading(false);
    }
  };
  
  useEffect(() => {
    fetchScheduleData();

  }, []);


  
  // ì²˜ìŒ ë Œë”ë§ ì‹œ ì¼ì • ìƒì„¸ ë°ì´í„° ë°›ì•„ì˜¤ê¸° (2ë‹¨ê³„ fetch)
  const fetchScheduleDetailData = async (dataToFetch?: any) => {
    await fetchScheduleDetailDataExternal({
      dataToFetch,
      scheduleData:null,
      propsScheduleInfo: props.scheduleInfo,
      setScheduleList,
      setManageAirline:() => {},
      createEmptyDay,
      safeJsonParse,
      repairJsonString,
      isAddOrRevise:'add',
    });
  };


 

  const [loading, setLoading] = useState<boolean>(true);

  // JSON ë¬¸ìì—´ ë³µêµ¬ í•¨ìˆ˜ (ì´ìŠ¤ì¼€ì´í”„ë˜ì§€ ì•Šì€ í°ë”°ì˜´í‘œ ì²˜ë¦¬)
  const repairJsonString = (jsonStr: string): string => {
    if (!jsonStr || typeof jsonStr !== 'string') return jsonStr;
    
    try {
      // ë¨¼ì € íŒŒì‹± ì‹œë„
      JSON.parse(jsonStr);
      return jsonStr; // ì´ë¯¸ ì˜¬ë°”ë¥¸ í˜•ì‹ì´ë©´ ê·¸ëŒ€ë¡œ ë°˜í™˜
    } catch (e) {
      // íŒŒì‹± ì‹¤íŒ¨ ì‹œ ë³µêµ¬ ì‹œë„
      // ìƒíƒœ ë¨¸ì‹  ë°©ì‹: ë¬¸ìì—´ ê°’ ë‚´ë¶€ì˜ í°ë”°ì˜´í‘œë§Œ ì´ìŠ¤ì¼€ì´í”„
      let result = '';
      let inString = false;
      let escapeNext = false;
      let inValue = false; // í˜„ì¬ ê°’ ë¬¸ìì—´ì¸ì§€ (í‚¤ê°€ ì•„ë‹Œ ê°’)
      
      for (let i = 0; i < jsonStr.length; i++) {
        const char = jsonStr[i];
        const afterChars = i < jsonStr.length - 1 ? jsonStr.substring(i + 1, Math.min(i + 20, jsonStr.length)) : '';
        const beforeChars = i > 0 ? jsonStr.substring(Math.max(0, i - 20), i) : '';
        
        if (escapeNext) {
          result += char;
          escapeNext = false;
          continue;
        }
        
        if (char === '\\') {
          result += char;
          escapeNext = true;
          continue;
        }
        
        if (char === '"') {
          // í‚¤ì˜ ëì¸ì§€ í™•ì¸ (" ë‹¤ìŒì— : ê°€ ì˜¤ë©´ í‚¤ì˜ ë)
          const isKeyEnd = /^\s*:/.test(afterChars);
          
          // ê°’ì˜ ì‹œì‘ì¸ì§€ í™•ì¸ (:, [, { ë’¤ì— " ê°€ ì˜¤ë©´ ê°’ì˜ ì‹œì‘)
          const isValueStart = /[:\[{]\s*$/.test(beforeChars);
          
          // ê°’ì˜ ëì¸ì§€ í™•ì¸ (" ë‹¤ìŒì— , ë˜ëŠ” } ë˜ëŠ” ] ê°€ ì˜¤ë©´ ê°’ì˜ ë)
          const isValueEnd = /^\s*[,}\]\]]/.test(afterChars);
          
          if (isKeyEnd) {
            // í‚¤ì˜ ëì´ë¯€ë¡œ ê·¸ëŒ€ë¡œ
            result += '"';
            inString = false;
            inValue = false;
          } else if (isValueStart && !inString) {
            // ê°’ì˜ ì‹œì‘
            result += '"';
            inString = true;
            inValue = true;
          } else if (inString && inValue) {
            // ê°’ ë¬¸ìì—´ ë‚´ë¶€ì—ì„œ í°ë”°ì˜´í‘œ ë°œê²¬
            if (isValueEnd) {
              // ë¬¸ìì—´ì˜ ë
              result += '"';
              inString = false;
              inValue = false;
            } else {
              // ë¬¸ìì—´ ë‚´ë¶€ì˜ í°ë”°ì˜´í‘œì´ë¯€ë¡œ ì´ìŠ¤ì¼€ì´í”„
              result += '\\"';
            }
          } else {
            // ê·¸ ì™¸ì˜ ê²½ìš°
            result += '"';
            if (isValueStart && !inString) {
              inString = true;
              inValue = true;
            } else if (isValueEnd && inString) {
              inString = false;
              inValue = false;
            }
          }
        } else {
          result += char;
        }
      }
      
      return result;
    }
  };


  // ì•ˆì „í•œ JSON íŒŒì‹± í—¬í¼ í•¨ìˆ˜
  const safeJsonParse = <T,>(jsonString: any, defaultValue: T): T => {
    if (!jsonString) return defaultValue;
    if (typeof jsonString !== 'string') {
      // ì´ë¯¸ ê°ì²´ì¸ ê²½ìš° ê·¸ëŒ€ë¡œ ë°˜í™˜
      return Array.isArray(jsonString) ? jsonString as T : (typeof jsonString === 'object' ? jsonString as T : defaultValue);
    }
    try {
      const trimmed = jsonString.trim();
      if (!trimmed || trimmed === '' || trimmed === 'null' || trimmed === 'undefined') {
        return defaultValue;
      }
      // JSON.parse ì‹œë„
      return JSON.parse(trimmed);
    } catch (e: any) {
      console.error('JSON íŒŒì‹± ì˜¤ë¥˜ (1ì°¨ ì‹œë„):', e?.message || e);
      
      // íŒŒì‹± ì‹¤íŒ¨ ì‹œ JSON ë³µêµ¬ ì‹œë„
      try {
        const trimmed = jsonString.trim();
        const repaired = repairJsonString(trimmed);
        return JSON.parse(repaired);
      } catch (e2: any) {
        console.error('JSON íŒŒì‹± ì˜¤ë¥˜ (ë³µêµ¬ í›„ ì¬ì‹œë„ ì‹¤íŒ¨):', e2?.message || e2);
        return defaultValue;
      }
    }
  };


  const [selectedNation, setSelectedNation] = useState<any>(null);

 


  // Helpers to create empty schedule structures
  const createEmptyDetail = () => ({
    id: 0,
    sort: '',
    locationIcon: '',
    location: '',
    isUseContent: false,
    locationContent: '',
    isViewLocation: true,
    locationDetail: [{ subLocation: '', subLocationContent: '', subLocationDetail: [], isUseContent: false }],
    airlineData: null
  });

  const createEmptyDay = () => ({
    breakfast: '',
    lunch: '',
    dinner: '',
    hotel: '',
    score: '',
    scheduleDetail: [createEmptyDetail()]
  });

  // ì¼ì •í‘œ -------------------------------------------------------------------------------------------------------------------

  const [scheduleList, setScheduleList] = useState<ModalScheduleDetailProps[]>( 
    [{
      airlineData: {
        sort: "",
        airlineCode: []
      },
      scheduleDetailData: [createEmptyDay()]
    }]
  );  
  const [selectedScheduleIndex, setSelectedScheduleIndex] = useState<number>(0);



  const datmealOptions = [
    { value: 'ì„ íƒ', label: 'ì„ íƒ' },
    { value: 'ê¸°ë‚´ì‹', label: 'ê¸°ë‚´ì‹' },
    { value: 'ì„ íƒì‹', label: 'ì„ íƒì‹' },
    { value: 'ì™¸ë¶€ì‹', label: 'ì™¸ë¶€ì‹' },
    { value: 'ë¦¬ì¡°íŠ¸', label: 'ë¦¬ì¡°íŠ¸' },
    { value: 'ììœ ì‹', label: 'ììœ ì‹' },
    { value: 'í˜„ì§€ì‹', label: 'í˜„ì§€ì‹' },
    { value: 'í˜¸í…”ì‹', label: 'í˜¸í…”ì‹' },
    { value: 'í¬í•¨', label: 'í¬í•¨' },
    { value: 'ë¶ˆí¬í•¨', label: 'ë¶ˆí¬í•¨' }
  ]
  const productOptions = [
    { value: 'ì„ íƒ', label: 'ì„ íƒ' },
    { value: 'ë¦¬ì¡°íŠ¸', label: 'ë¦¬ì¡°íŠ¸' },
    { value: 'í’€ë¹Œë¼', label: 'í’€ë¹Œë¼' },
    { value: 'í˜¸í…”', label: 'í˜¸í…”' },
    { value: 'ìš°ë¶“', label: 'ìš°ë¶“' },
    { value: 'ê²½ìœ ì§€', label: 'ê²½ìœ ì§€' },
  ]


  // ë„ì‹œëª…(ê³µí•­ì½”ë“œ) ë°˜í™˜ í•¨ìˆ˜
  function getCityNameByCode(code: string) {
    if (code === 'ICN') return 'ì¸ì²œ(ICN)';
    if (!selectedNation || !selectedNation.cities) return code;
    const city = selectedNation.cities.find((c: any) => c.airportCode === code);
    return city ? `${city.cityKo}(${code})` : code;
  }

  // ê¸°ì°¨/ë²„ìŠ¤/ì„ ë°• ì½”ë“œë¡œ ë„ì‹œëª… ì°¾ê¸°
  function getCityNameByTrafficCode(code: string, type: 'train' | 'bus' | 'ship') {
    if (!code) return code;
    if (!selectedNation || !selectedNation.cities) return code;
    
    for (const city of selectedNation.cities) {
      if (!city.trafficCode) continue;
      const trafficCode = typeof city.trafficCode === 'string' 
        ? safeJsonParse(city.trafficCode, null)
        : city.trafficCode;
      
      if (!trafficCode) continue;
      
      let codeList: any[] = [];
      if (type === 'train' && trafficCode.train) {
        codeList = trafficCode.train;
      } else if (type === 'bus' && trafficCode.bus) {
        codeList = trafficCode.bus;
      } else if (type === 'ship' && trafficCode.ship) {
        codeList = trafficCode.ship;
      }
      
      const found = codeList.find((item: any) => item.code === code);
      if (found) {
        const name = type === 'train' ? found.station : type === 'bus' ? found.terminal : found.port;
        return name ? `${name}(${code})` : `${city.cityKo}(${code})`;
      }
    }
    
    return code;
  }


  // ê²€ìƒ‰ ë¦¬ìŠ¤íŠ¸ ì¤‘ì— í•˜ë‚˜ ì„ íƒ ì‹œ ì¼ì • ìƒì„¸ ë°ì´í„° ì…ë ¥ (ëŒ€ë¶„ë¥˜ìš©)
  
  

  const [editMealRowIndex, setEditMealRowIndex] = useState<number>(-1);

  // ì¼ì •í‘œ ì¶”ê°€, ì‚­ì œ, ì´ë™ í•¨ìˆ˜
  const addDay = (idx:number) => {
    const copy = [...scheduleList];
    const target = copy[selectedScheduleIndex];
    if (!target || !target.scheduleDetailData) return;
    target.scheduleDetailData.splice(idx + 1, 0, createEmptyDay());
    setScheduleList(copy);
  };
  const deleteDay = (idx:number) => {
    const copy = [...scheduleList];
    const target = copy[selectedScheduleIndex];
    if (!target || !target.scheduleDetailData) return;
    if (target.scheduleDetailData.length > 1) {
      target.scheduleDetailData.splice(idx, 1);
      setScheduleList(copy);
    } else {
      alert('ë§ˆì§€ë§‰ 1ì¼ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    }
  };
  const moveDayUp = (idx:number) => {
    if (idx > 0) {
      const copy = [...scheduleList];
      const target = copy[selectedScheduleIndex];
      if (!target || !target.scheduleDetailData) return;
      const tmp = target.scheduleDetailData[idx];
      target.scheduleDetailData[idx] = target.scheduleDetailData[idx - 1];
      target.scheduleDetailData[idx - 1] = tmp;
      setScheduleList(copy);
    } else {
      alert('ë§¨ ìœ„ ì…ë‹ˆë‹¤.')
    }
  };
  const moveDayDown = (idx:number) => {
    const copy = [...scheduleList];
    const target = copy[selectedScheduleIndex];
    if (!target || !target.scheduleDetailData) return;
    if (idx < target.scheduleDetailData.length - 1) {
      const tmp = target.scheduleDetailData[idx];
      target.scheduleDetailData[idx] = target.scheduleDetailData[idx + 1];
      target.scheduleDetailData[idx + 1] = tmp;
      setScheduleList(copy);
    } else {
      alert('ë§¨ ì•„ë˜ ì…ë‹ˆë‹¤.')
    }
  };


  // ìœ í‹¸ í•¨ìˆ˜: ì¶œë°œ-ë„ì°© ì‹œê°„ìœ¼ë¡œ ì†Œìš”ì‹œê°„ ê³„ì‚°
  function getFlightDuration(departTime: any, arriveTime: any) {
    if (!departTime || !arriveTime) return '';
    const depH = parseInt(departTime.slice(0,2), 10);
    const depM = parseInt(departTime.slice(2,4), 10);
    const arrH = parseInt(arriveTime.slice(0,2), 10);
    const arrM = parseInt(arriveTime.slice(2,4), 10);
    let min = (arrH*60+arrM) - (depH*60+depM);
    if (min < 0) min += 24*60;
    const h = Math.floor(min/60);
    const m = min%60;
    return `${h.toString().padStart(2,'0')}ì‹œê°„ ${m.toString().padStart(2,'0')}ë¶„`;
  }







  return (
    <div className='modal-addinput'>

    

      {/* ìŠ¤ì¼€ì¤„ ------------------------------------------------------------------------------------------------ */}

      <div className="schedule-layout-container">
        <div className="schedule-layout-left" style={{width:'100%'}}>
          <div className="schedule-resort_detail_mx__section">
            <div className="schedule-resort_detail_schedule_header__wrapper">
              <span className="schedule-header__main">ì¶”ì²œ ì—¬í–‰ì¼ì •í‘œ</span>
              <div style={{display:'flex', gap:'8px', marginTop:'8px'}}>
                {
                  scheduleList.map((schedule, scheduleIndex) => {
                    return (
                      <button
                        key={scheduleIndex}
                        type="button"
                        style={{
                          padding:'6px 12px',
                          border: selectedScheduleIndex === scheduleIndex ? '2px solid #007bff' : '1px solid #bbb',
                          borderRadius:'6px',
                          background: selectedScheduleIndex === scheduleIndex ? '#e3f2fd' : '#fff',
                          cursor:'pointer',
                          fontSize:'13px',
                          fontWeight: selectedScheduleIndex === scheduleIndex ? '600' : '400',
                          color: selectedScheduleIndex === scheduleIndex ? '#007bff' : '#333',
                          minWidth:'80px',
                          transition:'all 0.2s ease'
                        }}
                        onClick={() => setSelectedScheduleIndex(scheduleIndex)}
                      >
                        {
                          schedule.airlineData.sort === '' 
                          ? (
                            <p style={{color:'#999'}}>í•­ê³µí¸ì—†ìŒ</p>
                          )
                          : (
                           <>
                            <p>{schedule.airlineData.sort === 'direct' ? 'ì§í•­' : 'ê²½ìœ '}</p>
                            <div style={{margin:'0 2px', fontSize:'11px', display:'grid', gridTemplateColumns:'repeat(2, 1fr)'}}>
                              {schedule.airlineData.airlineCode && schedule.airlineData.airlineCode.length > 0 
                                ? schedule.airlineData.airlineCode.map((code, idx) => (
                                    <p key={idx} style={{margin:'0', lineHeight:'1.2'}}>{code}</p>
                                  ))
                                : <p style={{margin:'0', color:'#999'}}>#</p>
                              }
                            </div>
                           </>
                          )
                        }
                      </button>
                    )
                })}
                <button
                  type="button"
                  style={{
                    padding:'6px 10px', 
                    border:'1px solid #ddd', 
                    borderRadius:'4px', 
                    background:'#fff', 
                    cursor:'pointer',
                    color:'#6c757d',
                  }}
                  onClick={() => {
                    if (selectedScheduleIndex >= 0 && scheduleList[selectedScheduleIndex]) {
                      // ì‚¬ìš©ìì—ê²Œ ì´ˆê¸°í™” í™•ì¸ ìš”ì²­
                      if (window.confirm('ì„ íƒëœ ìŠ¤ì¼€ì¤„ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nëª¨ë“  ì…ë ¥ëœ ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.')) {
                        // ì„ íƒëœ ìŠ¤ì¼€ì¤„ì„ ë¹ˆ ìƒíƒœë¡œ ì´ˆê¸°í™”
                        const copy = [...scheduleList];
                        copy[selectedScheduleIndex] = {
                          airlineData: { sort: '', airlineCode: [] },
                          scheduleDetailData: [
                            {
                              breakfast: '',
                              lunch: '',
                              dinner: '',
                              hotel: '',
                              score: '',
                              scheduleDetail: [
                                {
                                  id: 0,
                                  sort: '',
                                  location: '',
                                  isUseContent: false,
                                  isViewLocation: true,
                                  locationDetail: [{ subLocation: '', isUseContent: false, subLocationContent: '', subLocationDetail: [] }],
                                  airlineData: null
                                }
                              ]
                            }
                          ]
                        };
                        setScheduleList(copy);
                      }
                    }
                  }}
                  disabled={selectedScheduleIndex < 0}
                >
                  ì´ˆê¸°í™”
                </button>
                <button
                  type="button"
                  style={{padding:'6px 10px', border:'1px solid #333', borderRadius:'4px', background:'#fff', cursor:'pointer'}}
                  onClick={() => {
                    // í˜„ì¬ ì„ íƒëœ ìŠ¤ì¼€ì¤„ì„ ë³µì‚¬í•˜ì—¬ ìƒˆë¡œìš´ ìŠ¤ì¼€ì¤„ë¡œ ì¶”ê°€
                    if (scheduleList.length === 0) {
                      // ìŠ¤ì¼€ì¤„ì´ ì—†ëŠ” ê²½ìš° ë¹ˆ ìŠ¤ì¼€ì¤„ ì¶”ê°€
                      const copy = [...scheduleList];
                      copy.push({
                        airlineData: { sort: '', airlineCode: [] },
                        scheduleDetailData: [
                          {
                            breakfast: '',
                            lunch: '',
                            dinner: '',
                            hotel: '',
                            score: '',
                            scheduleDetail: [
                              {
                                id: 0,
                                sort: '',
                                location: '',
                                isUseContent: false,
                                isViewLocation: true,
                                locationDetail: [{ subLocation: '', isUseContent: false, subLocationContent: '', subLocationDetail: [] }],
                                airlineData: null
                              }
                            ]
                          }
                        ]
                      });
                      setScheduleList(copy);
                      setSelectedScheduleIndex(copy.length - 1);
                    } else {
                      // í˜„ì¬ ì„ íƒëœ ìŠ¤ì¼€ì¤„ì„ ë³µì‚¬í•˜ì—¬ ì¶”ê°€
                      const copy = [...scheduleList];
                      const selectedSchedule = copy[selectedScheduleIndex];
                      
                      // ê¹Šì€ ë³µì‚¬ë¡œ scheduleDetailData ë³µì‚¬
                      const copiedScheduleDetailData = selectedSchedule.scheduleDetailData.map(day => ({
                        ...day,
                        scheduleDetail: day.scheduleDetail.map(detail => ({
                          ...detail,
                          locationDetail: detail.locationDetail.map(loc => ({
                            ...loc,
                            subLocationDetail: [...loc.subLocationDetail]
                          }))
                        }))
                      }));
                      
                      copy.push({
                        ...selectedSchedule,
                        scheduleDetailData: copiedScheduleDetailData
                      });
                      
                      setScheduleList(copy);
                      setSelectedScheduleIndex(copy.length - 1);
                    }
                  }}
                  >
                    <p>ì¶”ê°€</p>
                    <p>(ë³µì‚¬)</p>
                </button>
                <button
                  type="button"
                  style={{
                    padding:'6px 10px', 
                    border:'1px solid #dc3545', 
                    borderRadius:'4px', 
                    background:'#fff', 
                    cursor:'pointer',
                    color:'#dc3545',
                  }}
                  onClick={() => {
                    if (scheduleList.length > 1 && selectedScheduleIndex >= 0) {
                      // ì‚¬ìš©ìì—ê²Œ ì‚­ì œ í™•ì¸ ìš”ì²­
                      if (window.confirm('ì„ íƒëœ ìŠ¤ì¼€ì¤„ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                        // ìŠ¤ì¼€ì¤„ì´ 2ê°œ ì´ìƒì´ê³  ì„ íƒëœ ìŠ¤ì¼€ì¤„ì´ ìˆëŠ” ê²½ìš°ì—ë§Œ ì‚­ì œ ê°€ëŠ¥
                        const copy = [...scheduleList];
                        copy.splice(selectedScheduleIndex, 1);
                        setScheduleList(copy);
                        
                        // ì‚­ì œ í›„ ì„ íƒëœ ì¸ë±ìŠ¤ ì¡°ì •
                        if (selectedScheduleIndex >= copy.length) {
                          setSelectedScheduleIndex(copy.length - 1);
                        }
                      }
                    } else if (scheduleList.length === 1) {
                      // ë§ˆì§€ë§‰ ìŠ¤ì¼€ì¤„ì¸ ê²½ìš° ê²½ê³  ë©”ì‹œì§€
                      alert('ìµœì†Œ 1ê°œì˜ ìŠ¤ì¼€ì¤„ì€ ìœ ì§€í•´ì•¼ í•©ë‹ˆë‹¤.');
                    }
                  }}
                  disabled={scheduleList.length <= 1}
                >
                  <p>ì„ íƒ</p>
                  <p>ì‚­ì œ</p>
                </button>
              </div>
            </div>

            
            <div className="schedule-schedule__tables__wrapper">
              {
                scheduleList.map((schedule, scheduleIndex) => {
                  return (
                    <div>
                      { selectedScheduleIndex === scheduleIndex &&
                        schedule.scheduleDetailData.map((dayItem, dayIndex) => {
                          return (
                            <div className="schedule-schedule__table__wrapper" key={dayIndex}>
                              <div className="schedule-schedule__header" style={{display:'flex', alignItems:'center', justifyContent:'space-between'}}>
                                <div style={{display:'flex', alignItems:'center'}}>
                                  <span className="schedule-main__text">{dayIndex +1} DAY</span>
                                </div>
                                <div style={{display:'flex', gap:'6px'}}>
                                  <button
                                    type="button"
                                    style={{padding:'2px 8px', border:'1px solid #bbb', borderRadius:'4px', background:'#fff', cursor:'pointer'}}
                                    title="DAY ì¶”ê°€"
                                    onClick={() => addDay(dayIndex)}
                                  >+
                                  </button>
                                  <button
                                    type="button"
                                    style={{padding:'2px 8px', border:'1px solid #bbb', borderRadius:'4px', background:'#fff', cursor:'pointer'}}
                                    title="DAY ì‚­ì œ"
                                    onClick={() => deleteDay(dayIndex)}
                                  >â€“
                                  </button>
                                  <button
                                    type="button"
                                    style={{padding:'2px 8px', border:'1px solid #bbb', borderRadius:'4px', background:'#fff', cursor:'pointer'}}
                                    title="DAY ìœ„ë¡œ"
                                    onClick={() => moveDayUp(dayIndex)}
                                  >â–²
                                  </button>
                                  <button
                                    type="button"
                                    style={{padding:'2px 8px', border:'1px solid #bbb', borderRadius:'4px', background:'#fff', cursor:'pointer'}}
                                    title="DAY ì•„ë˜ë¡œ"
                                    onClick={() => moveDayDown(dayIndex)}
                                  >â–¼
                                  </button>
                                </div>
                              </div>
                              <div className="schedule-schedule__main__wrapper">
                                { (dayItem.scheduleDetail && dayItem.scheduleDetail.length > 0)
                                  &&
                                  dayItem.scheduleDetail.map((loctionItem:any, locationIndex:any) => (
                                      <div className="schedule-schedule__element__wrapper" key={locationIndex}>
                                        <div className="schedule-schedule__element__header__wrapper">
                                          <div className="schedule-schedule__location__wrapper">
                                            {loctionItem.isViewLocation !== false && (
                                            <div className="schedule-location__absolute__wrapper">
                                              <div style={{position: 'relative'}}>
                                                <button
                                                  type="button"
                                                  style={{
                                                    background: 'none',
                                                    border: 'none',
                                                    cursor: 'pointer',
                                                    padding: '4px',
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    justifyContent: 'center'
                                                  }}
                                                  onClick={() => {
                                                    
                                                  }}
                                                >
                                                  {(loctionItem.locationIcon || loctionItem.sort) === 'airline' ? (
                                                    <span style={{color: '#ff6b6b', fontSize: '30px', fontWeight: 'bold'}}>âœˆ</span>
                                                  ) : (loctionItem.locationIcon || loctionItem.sort) === 'train' ? (
                                                    <span style={{color: '#5fb7ef', fontSize: '30px', fontWeight: 'bold'}}>ğŸš‚</span>
                                                  ) : (loctionItem.locationIcon || loctionItem.sort) === 'bus' ? (
                                                    <span style={{color: '#5fb7ef', fontSize: '30px', fontWeight: 'bold'}}>ğŸšŒ</span>
                                                  ) : (loctionItem.locationIcon || loctionItem.sort) === 'ship' ? (
                                                    <span style={{color: '#5fb7ef', fontSize: '30px', fontWeight: 'bold'}}>ğŸš¢</span>
                                                  ) : (
                                                    <ImLocation color='#5fb7ef' size={20}/>
                                                  )}
                                                </button>
                                                
                                              </div>
                                            </div>
                                            )}
                                            <div style={{display:'flex', alignItems:'center', marginBottom:'10px', justifyContent:'flex-start', paddingLeft:'30px'}}>
                                              {(loctionItem.sort !== 'airline' && loctionItem.sort !== 'train' && loctionItem.sort !== 'bus' && loctionItem.sort !== 'ship') &&
                                                <>
                                                  {loctionItem.isViewLocation !== false && (
                                                    <>
                                                      <input
                                                        className="inputdefault"
                                                        style={{width:'300px', margin:'0'}}
                                                        value={loctionItem.location || ''}
                                                        onChange={e => {
                                                          setScheduleList(prev => {
                                                            const next = [...prev];
                                                            const schedule = next[selectedScheduleIndex];
                                                            const day = schedule?.scheduleDetailData?.[dayIndex];
                                                            const currentItem = day?.scheduleDetail?.[locationIndex];

                                                            if (!schedule || !day || !currentItem) return prev;

                                                            const newScheduleDetail = [...day.scheduleDetail];
                                                            const updatedItem = { ...currentItem, sort: 'text', st: 'text', location: e.target.value };
                                                            newScheduleDetail[locationIndex] = updatedItem;

                                                            const updatedDay = { ...day, scheduleDetail: newScheduleDetail };

                                                            const newScheduleDetailData = [...schedule.scheduleDetailData];
                                                            newScheduleDetailData[dayIndex] = updatedDay;

                                                            next[selectedScheduleIndex] = { ...schedule, scheduleDetailData: newScheduleDetailData };

                                                            return next;
                                                          });
                                                        }}
                                                      />
                                                      {/* ì„¤ëª…ì¶”ê°€/ì„¤ëª…ì—†ìŒ ë²„íŠ¼ */}
                                                      {!loctionItem.isUseContent ? (
                                                        <button
                                                          type="button"
                                                          style={{
                                                            color: '#333',
                                                            border: '1px solid #ddd',
                                                            backgroundColor:'#fff',
                                                            borderRadius: '4px',
                                                            padding: '8px 16px',
                                                            fontSize: '14px',
                                                            cursor: 'pointer',
                                                            fontWeight: '500',
                                                            marginLeft: '8px'
                                                          }}
                                                          onClick={() => {
                                                            setScheduleList(prev => {
                                                              const next = [...prev];
                                                              const schedule = next[selectedScheduleIndex];
                                                              const day = schedule?.scheduleDetailData?.[dayIndex];
                                                              const currentItem = day?.scheduleDetail?.[locationIndex];

                                                              if (!schedule || !day || !currentItem) return prev;

                                                              const newScheduleDetail = [...day.scheduleDetail];
                                                              const updatedItem = { ...currentItem, isUseContent: true };
                                                              newScheduleDetail[locationIndex] = updatedItem;

                                                              const updatedDay = { ...day, scheduleDetail: newScheduleDetail };

                                                              const newScheduleDetailData = [...schedule.scheduleDetailData];
                                                              newScheduleDetailData[dayIndex] = updatedDay;

                                                              next[selectedScheduleIndex] = { ...schedule, scheduleDetailData: newScheduleDetailData };

                                                              return next;
                                                            });
                                                          }}
                                                        >
                                                          ì„¤ëª…ì¶”ê°€
                                                        </button>
                                                      ) : (
                                                        <button
                                                          type="button"
                                                          style={{
                                                            color: '#333',
                                                            border: '1px solid #ddd',
                                                            backgroundColor: '#fff',
                                                            borderRadius: '4px',
                                                            padding: '8px 16px',
                                                            fontSize: '14px',
                                                            cursor: 'pointer',
                                                            fontWeight: '500',
                                                            marginLeft: '8px'
                                                          }}
                                                          onClick={() => {
                                                            setScheduleList(prev => {
                                                              const next = [...prev];
                                                              const schedule = next[selectedScheduleIndex];
                                                              const day = schedule?.scheduleDetailData?.[dayIndex];
                                                              const currentItem = day?.scheduleDetail?.[locationIndex];

                                                              if (!schedule || !day || !currentItem) return prev;

                                                              const newScheduleDetail = [...day.scheduleDetail];
                                                              const updatedItem = { ...currentItem, locationContent: '', isUseContent: false };
                                                              newScheduleDetail[locationIndex] = updatedItem;

                                                              const updatedDay = { ...day, scheduleDetail: newScheduleDetail };

                                                              const newScheduleDetailData = [...schedule.scheduleDetailData];
                                                              newScheduleDetailData[dayIndex] = updatedDay;

                                                              next[selectedScheduleIndex] = { ...schedule, scheduleDetailData: newScheduleDetailData };

                                                              return next;
                                                            });
                                                          }}
                                                        >
                                                          ì„¤ëª…ì—†ì• ê¸°
                                                        </button>
                                                      )}
                                                    </>
                                                  )}
                                                  {/* ë¬¶ìŒì¼ì • | ìƒì„¸ì¼ì • íƒ­ ë²„íŠ¼ */}
                                                  {(loctionItem.sort !== 'airline' && loctionItem.sort !== 'train' && loctionItem.sort !== 'bus' && loctionItem.sort !== 'ship') && loctionItem.isViewLocation !== false && (
                                                    <div style={{
                                                      display: 'flex',
                                                      border: '1px solid #ddd',
                                                      borderRadius: '4px',
                                                      overflow: 'hidden',
                                                      marginLeft: '8px',
                                                      height: '30px'
                                                    }}>
                                                      <button
                                                        type="button"
                                                        style={{
                                                          padding: '4px 12px',
                                                          border: 'none',
                                                          background: '#fff',
                                                          color: '#333',
                                                          cursor: 'pointer',
                                                          fontSize: '12px',
                                                          fontWeight: '400',
                                                          borderRight: '1px solid #ddd'
                                                        }}
                                                        onClick={() => {
                                                          const tabKey = `${dayIndex}-${locationIndex}`;
                                                       
                                                        }}
                                                      >
                                                        ë¬¶ìŒì¼ì •
                                                      </button>
                                                      <button
                                                        type="button"
                                                        style={{
                                                          padding: '4px 12px',
                                                          border: 'none',
                                                          background: '#fff',
                                                          color: '#333',
                                                          cursor: 'pointer',
                                                          fontSize: '12px',
                                                          fontWeight: '400'
                                                        }}
                                                        onClick={() => {
                                                          const tabKey = `${dayIndex}-${locationIndex}`;
                                                        
                                                        }}
                                                      >
                                                        ìƒì„¸ì¼ì •
                                                      </button>
                                                    </div>
                                                  )}
                                                </>
                                              }
                                              {/* ë²„íŠ¼ ê·¸ë£¹: ModalAddScheduleDetail.tsxì™€ ë™ì¼í•œ êµ¬ì¡°/ìŠ¤íƒ€ì¼ */}
                                              <div className="schedule-schedule__btns" style={{display:'flex', alignItems:'center', marginLeft:'4px'}}>
                                                <button
                                                  className="schedule-schedule__btn"
                                                  style={{padding:'2px 10px'}}
                                                  type="button"
                                                  onClick={() => {
                                                    // +: scheduleDetail ì¶”ê°€
                                                    const copy = [...scheduleList];
                                                    copy[selectedScheduleIndex].scheduleDetailData[dayIndex].scheduleDetail.splice(locationIndex + 1, 0, {
                                                      id: 0, 
                                                      sort: "", 
                                                      locationIcon: '',
                                                      location: '', 
                                                      isUseContent: false,
                                                      locationContent: '',
                                                      isViewLocation: true,
                                                      locationDetail: [{
                                                        subLocation: "", 
                                                        isUseContent: false,
                                                        subLocationContent: "", 
                                                        subLocationDetail: []
                                                      }], 
                                                      airlineData: null
                                                    });
                                                    setScheduleList(copy);
                                                  }}
                                                >+</button>
                                                <button
                                                  className="schedule-schedule__btn"
                                                  style={{padding:'2px 10px'}}
                                                  type="button"
                                                  onClick={() => {
                                                    // -: scheduleDetail ì‚­ì œ
                                                    if (dayItem.scheduleDetail.length > 1) {
                                                      const copy = [...scheduleList];
                                                      copy[selectedScheduleIndex].scheduleDetailData[dayIndex].scheduleDetail.splice(locationIndex, 1);
                                                      setScheduleList(copy);
                                                    }
                                                  }}
                                                >â€“</button>
                                                <button
                                                  className="schedule-schedule__btn"
                                                  style={{padding:'2px 7px'}}
                                                  type="button"
                                                  onClick={() => {
                                                    // ìœ„ë¡œ ì´ë™
                                                    if (locationIndex > 0) {
                                                      // ê°™ì€ day ë‚´ì—ì„œ ìœ„ë¡œ ì´ë™
                                                      const copy = [...scheduleList];
                                                      const temp = copy[selectedScheduleIndex].scheduleDetailData[dayIndex].scheduleDetail[locationIndex];
                                                      copy[selectedScheduleIndex].scheduleDetailData[dayIndex].scheduleDetail[locationIndex] = copy[selectedScheduleIndex].scheduleDetailData[dayIndex].scheduleDetail[locationIndex - 1];
                                                      copy[selectedScheduleIndex].scheduleDetailData[dayIndex].scheduleDetail[locationIndex - 1] = temp;
                                                      setScheduleList(copy);
                                                    } else if (dayIndex > 0) {
                                                      // ì´ì „ dayì˜ ë§ˆì§€ë§‰ ìœ„ì¹˜ë¡œ ì´ë™
                                                      const copy = [...scheduleList];
                                                      const currentItem = copy[selectedScheduleIndex].scheduleDetailData[dayIndex].scheduleDetail[locationIndex];
                                                      const prevDay = copy[selectedScheduleIndex].scheduleDetailData[dayIndex - 1];
                                                      
                                                      // í˜„ì¬ ìœ„ì¹˜ì—ì„œ ì œê±°
                                                      copy[selectedScheduleIndex].scheduleDetailData[dayIndex].scheduleDetail.splice(locationIndex, 1);
                                                      
                                                      // ì´ì „ dayì˜ ë§ˆì§€ë§‰ ìœ„ì¹˜ì— ì¶”ê°€
                                                      prevDay.scheduleDetail.push(currentItem);
                                                      
                                                      setScheduleList(copy);
                                                    } else {
                                                      alert('ì²« ë²ˆì§¸ dayì˜ ì²« ë²ˆì§¸ ìœ„ì¹˜ì…ë‹ˆë‹¤.')
                                                    }
                                                  }}
                                                ><TiArrowSortedUp /></button>
                                                <button
                                                  className="schedule-schedule__btn"
                                                  style={{padding:'2px 7px'}}
                                                  type="button"
                                                  onClick={() => {
                                                    // ì•„ë˜ë¡œ ì´ë™
                                                    if (locationIndex < dayItem.scheduleDetail.length - 1) {
                                                      // ê°™ì€ day ë‚´ì—ì„œ ì•„ë˜ë¡œ ì´ë™
                                                      const copy = [...scheduleList];
                                                      const temp = copy[selectedScheduleIndex].scheduleDetailData[dayIndex].scheduleDetail[locationIndex];
                                                      copy[selectedScheduleIndex].scheduleDetailData[dayIndex].scheduleDetail[locationIndex] = copy[selectedScheduleIndex].scheduleDetailData[dayIndex].scheduleDetail[locationIndex + 1];
                                                      copy[selectedScheduleIndex].scheduleDetailData[dayIndex].scheduleDetail[locationIndex + 1] = temp;
                                                      setScheduleList(copy);
                                                    } else if (dayIndex < scheduleList[selectedScheduleIndex].scheduleDetailData.length - 1) {
                                                      // ë‹¤ìŒ dayì˜ ì²« ë²ˆì§¸ ìœ„ì¹˜ë¡œ ì´ë™
                                                      const copy = [...scheduleList];
                                                      const currentItem = copy[selectedScheduleIndex].scheduleDetailData[dayIndex].scheduleDetail[locationIndex];
                                                      const nextDay = copy[selectedScheduleIndex].scheduleDetailData[dayIndex + 1];
                                                      
                                                      // í˜„ì¬ ìœ„ì¹˜ì—ì„œ ì œê±°
                                                      copy[selectedScheduleIndex].scheduleDetailData[dayIndex].scheduleDetail.splice(locationIndex, 1);
                                                      
                                                      // ë‹¤ìŒ dayì˜ ì²« ë²ˆì§¸ ìœ„ì¹˜ì— ì¶”ê°€
                                                      if (nextDay.scheduleDetail.length === 0) {
                                                        nextDay.scheduleDetail.push(currentItem);
                                                      } else {
                                                        nextDay.scheduleDetail.unshift(currentItem);
                                                      }
                                                      
                                                      setScheduleList(copy);
                                                    } else {
                                                      alert('ë§ˆì§€ë§‰ dayì˜ ë§ˆì§€ë§‰ ìœ„ì¹˜ì…ë‹ˆë‹¤.')
                                                    }
                                                  }}
                                                ><TiArrowSortedDown /></button>
                                                <button
                                                  className="schedule-schedule__btn"
                                                  onClick={async ()=>{
                                                  
                                                  }}
                                                >êµí†µí¸ì¶”ê°€</button>
                                                <button
                                                  className="schedule-schedule__btn"
                                                  onClick={() => {
                                                    setScheduleList(prev => {
                                                      const next = [...prev];
                                                      const schedule = next[selectedScheduleIndex];
                                                      const day = schedule?.scheduleDetailData?.[dayIndex];
                                                      // idxë¥¼ ì‚¬ìš©í•˜ì—¬ ì •í™•í•œ í•­ëª© ì°¾ê¸° (idxê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ locationIndex ì‚¬ìš©)
                                                      const currentItem = (loctionItem.idx !== undefined && loctionItem.idx !== null)
                                                        ? day?.scheduleDetail?.find((item: any) => item.idx === loctionItem.idx) || day?.scheduleDetail?.[locationIndex]
                                                        : day?.scheduleDetail?.[locationIndex];
                                                      if (!schedule || !day || !currentItem) return prev;
                                                      const newScheduleDetail = [...day.scheduleDetail];
                                                      // idxë¥¼ ì‚¬ìš©í•˜ì—¬ ì •í™•í•œ ìœ„ì¹˜ ì°¾ê¸° (idxê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ locationIndex ì‚¬ìš©)
                                                      const itemIndex = (loctionItem.idx !== undefined && loctionItem.idx !== null)
                                                        ? newScheduleDetail.findIndex((item: any) => item.idx === loctionItem.idx)
                                                        : -1;
                                                      const targetIndex = itemIndex !== -1 ? itemIndex : locationIndex;
                                                      // isViewLocationì´ undefinedì¼ ë•ŒëŠ” trueë¡œ ê°„ì£¼í•˜ê³  falseë¡œ í† ê¸€
                                                      const currentIsViewLocation = currentItem.isViewLocation !== undefined 
                                                        ? currentItem.isViewLocation 
                                                        : true;
                                                      const updatedItem = { ...currentItem, isViewLocation: !currentIsViewLocation };
                                                      newScheduleDetail[targetIndex] = updatedItem;
                                                      const updatedDay = { ...day, scheduleDetail: newScheduleDetail };
                                                      const newScheduleDetailData = [...schedule.scheduleDetailData];
                                                      newScheduleDetailData[dayIndex] = updatedDay;
                                                      next[selectedScheduleIndex] = { ...schedule, scheduleDetailData: newScheduleDetailData };
                                                      return next;
                                                    });
                                                  }}
                                                >{loctionItem.isViewLocation !== false ? 'ë…¸ì¶œì•ˆí•¨' : 'ë…¸ì¶œí•¨'}</button>
                                              </div>
                                            </div>
                                          </div>
                                        </div>
                                        {/* locationContent ì…ë ¥ ì˜ì—­ */}
                                        {loctionItem.isUseContent && (
                                          <div style={{
                                            padding: '12px 30px',
                                          }}>
                                            <textarea
                                              style={{
                                                width: '100%',
                                                minHeight: '80px',
                                                padding: '8px 12px',
                                                border: '1px solid #ddd',
                                                borderRadius: '4px',
                                                fontSize: '14px',
                                                fontFamily: 'inherit',
                                                resize: 'vertical',
                                                lineHeight: '1.5'
                                              }}
                                              value={loctionItem.locationContent || ''}
                                              onChange={e => {
                                                setScheduleList(prev => {
                                                  const next = [...prev];
                                                  const schedule = next[selectedScheduleIndex];
                                                  const day = schedule?.scheduleDetailData?.[dayIndex];
                                                  const currentItem = day?.scheduleDetail?.[locationIndex];

                                                  if (!schedule || !day || !currentItem) return prev;

                                                  const newScheduleDetail = [...day.scheduleDetail];
                                                  const updatedItem = { ...currentItem, locationContent: e.target.value };
                                                  newScheduleDetail[locationIndex] = updatedItem;

                                                  const updatedDay = { ...day, scheduleDetail: newScheduleDetail };

                                                  const newScheduleDetailData = [...schedule.scheduleDetailData];
                                                  newScheduleDetailData[dayIndex] = updatedDay;

                                                  next[selectedScheduleIndex] = { ...schedule, scheduleDetailData: newScheduleDetailData };

                                                  return next;
                                                });
                                              }}
                                            />
                                          </div>
                                        )}
                                        
                                        {loctionItem.sort === 'airline' && loctionItem.airlineData ? (
                                          // ì²¨ë¶€ ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ì˜ í•­ê³µí¸ ì •ë³´ UI
                                          <div className="schedule__element__wrapper">
                                          <div className="schedule-flight__schedule__board__wrapper">
                                            <div className="schedule-flight__schedule__board">
                                                {loctionItem.airlineData && loctionItem.sort === 'airline' ? (
                                                // í•­ê³µí¸ í‘œì‹œ (ì§í•­/ê²½ìœ  êµ¬ë¶„ ì—†ì´)
                                                <>
                                                  <div className="schedule-flight__info__wrapper">
                                                    {(() => {
                                                      const airlineCode = loctionItem.airlineData?.airlineCode?.slice(0, 2);
                                                      try {
                                                        return <img src={require(`../../../airlineLogos/${airlineCode}.png`)} alt="í•­ê³µì‚¬ë¡œê³ " />;
                                                      } catch {
                                                        return null;
                                                      }
                                                    })()}
                                                    <span>{loctionItem.airlineData?.airlineName || '-'}</span>
                                                    <span style={{marginLeft:'10px'}}>{loctionItem.airlineData?.airlineCode}</span>
                                                    {loctionItem.airlineData?.addDay === 'true' && (
                                                      <span style={{marginLeft:'10px', color:'#ff6b6b', fontWeight:'bold'}}>+1D</span>
                                                    )}
                                                  </div>
                                                  <div className="schedule-flight__time__wrapper">
                                                    <span className="schedule-flight__time">{getFlightDuration(loctionItem.airlineData?.departTime, loctionItem.airlineData?.arriveTime)}</span>
                                                    <div className="schedule-depart__info">
                                                      <div />
                                                      <span className="schedule-time__text">{loctionItem.airlineData?.departTime?.slice(0,2) + ':' + loctionItem.airlineData?.departTime?.slice(2,4)}</span>
                                                      <span className="schedule-airport__text">{getCityNameByCode(loctionItem.airlineData?.depart)} ì¶œë°œ</span>
                                                    </div>
                                                    <div className="schedule-arrive__info">
                                                      <div />
                                                      <span className="schedule-time__text">{loctionItem.airlineData?.arriveTime?.slice(0,2) + ':' + loctionItem.airlineData?.arriveTime?.slice(2,4)}</span>
                                                      <span className="schedule-airport__text">{getCityNameByCode(loctionItem.airlineData?.arrive)} ë„ì°©</span>
                                                    </div>
                                                  </div>
                                                </>
                                              ) : (
                                                // ì§í•­ í•­ê³µí¸: ê¸°ì¡´ í‘œì‹œ ë°©ì‹
                                                <>
                                                  <div className="schedule-flight__info__wrapper">
                                                    {(() => {
                                                      const airlineCode = loctionItem.airlineData?.airlineCode?.slice(0, 2);
                                                      try {
                                                        return <img src={require(`../../../airlineLogos/${airlineCode}.png`)} alt="í•­ê³µì‚¬ë¡œê³ " />;
                                                      } catch {
                                                        return null;
                                                      }
                                                    })()}
                                                    <span>{loctionItem.airlineData?.airlineName || '-'}</span>
                                                    <span style={{marginLeft:'10px'}}>{loctionItem.airlineData?.airlineCode}</span>
                                                    {loctionItem.airlineData?.addDay === 'true' && (
                                                      <span style={{marginLeft:'10px', color:'#ff6b6b', fontWeight:'bold'}}>+1D</span>
                                                    )}
                                                  </div>
                                                  <div className="schedule-flight__time__wrapper">
                                                    <span className="schedule-flight__time">{getFlightDuration(loctionItem.airlineData?.departTime, loctionItem.airlineData?.arriveTime)}</span>
                                                    <div className="schedule-depart__info">
                                                      <div />
                                                      <span className="schedule-time__text">{loctionItem.airlineData?.departTime?.slice(0,2) + ':' + loctionItem.airlineData?.departTime?.slice(2,4)}</span>
                                                      <span className="schedule-airport__text">{getCityNameByCode(loctionItem.airlineData?.depart)} ì¶œë°œ</span>
                                                    </div>
                                                    <div className="schedule-arrive__info">
                                                      <div />
                                                      <span className="schedule-time__text">{loctionItem.airlineData?.arriveTime?.slice(0,2) + ':' + loctionItem.airlineData?.arriveTime?.slice(2,4)}</span>
                                                      <span className="schedule-airport__text">{getCityNameByCode(loctionItem.airlineData?.arrive)} ë„ì°©</span>
                                                    </div>
                                                  </div>
                                                </>
                                              )}
                                            </div>
                                          </div>
                                        </div>
                                        ) : null}
                                        {/* ê¸°ì°¨í¸ ë Œë”ë§ */}
                                        {loctionItem.sort === 'train' && loctionItem.trainData ? (
                                          <div className="schedule__element__wrapper">
                                            <div className="schedule-flight__schedule__board__wrapper">
                                              <div className="schedule-flight__schedule__board">
                                                <div className="schedule-flight__info__wrapper">
                                                  <span style={{fontSize:'16px', marginRight:'10px'}}>ğŸš‚</span>
                                                  <span>{loctionItem.trainData?.trainName || '-'}</span>
                                                  <span style={{marginLeft:'10px'}}>{loctionItem.trainData?.trainCode || '-'}</span>
                                                  {loctionItem.trainData?.addDay === 'true' && (
                                                    <span style={{marginLeft:'10px', color:'#ff6b6b', fontWeight:'bold'}}>+1D</span>
                                                  )}
                                                </div>
                                                <div className="schedule-flight__time__wrapper">
                                                  <span className="schedule-flight__time">{getFlightDuration(loctionItem.trainData?.departTime, loctionItem.trainData?.arriveTime)}</span>
                                                  <div className="schedule-depart__info">
                                                    <div />
                                                    <span className="schedule-time__text">{loctionItem.trainData?.departTime?.slice(0,2) + ':' + loctionItem.trainData?.departTime?.slice(2,4)}</span>
                                                    <span className="schedule-airport__text">{getCityNameByTrafficCode(loctionItem.trainData?.depart, 'train')} ì¶œë°œ</span>
                                                  </div>
                                                  <div className="schedule-arrive__info">
                                                    <div />
                                                    <span className="schedule-time__text">{loctionItem.trainData?.arriveTime?.slice(0,2) + ':' + loctionItem.trainData?.arriveTime?.slice(2,4)}</span>
                                                    <span className="schedule-airport__text">{getCityNameByTrafficCode(loctionItem.trainData?.arrive, 'train')} ë„ì°©</span>
                                                  </div>
                                                </div>
                                              </div>
                                            </div>
                                          </div>
                                        ) : null}
                                        {/* ë²„ìŠ¤í¸ ë Œë”ë§ */}
                                        {loctionItem.sort === 'bus' && loctionItem.busData ? (
                                          <div className="schedule__element__wrapper">
                                            <div className="schedule-flight__schedule__board__wrapper">
                                              <div className="schedule-flight__schedule__board">
                                                <div className="schedule-flight__info__wrapper">
                                                  <span style={{fontSize:'16px', marginRight:'10px'}}>ğŸšŒ</span>
                                                  <span>{loctionItem.busData?.busName || '-'}</span>
                                                  <span style={{marginLeft:'10px'}}>{loctionItem.busData?.busCode || '-'}</span>
                                                  {loctionItem.busData?.addDay === 'true' && (
                                                    <span style={{marginLeft:'10px', color:'#ff6b6b', fontWeight:'bold'}}>+1D</span>
                                                  )}
                                                </div>
                                                <div className="schedule-flight__time__wrapper">
                                                  <span className="schedule-flight__time">{getFlightDuration(loctionItem.busData?.departTime, loctionItem.busData?.arriveTime)}</span>
                                                  <div className="schedule-depart__info">
                                                    <div />
                                                    <span className="schedule-time__text">{loctionItem.busData?.departTime?.slice(0,2) + ':' + loctionItem.busData?.departTime?.slice(2,4)}</span>
                                                    <span className="schedule-airport__text">{getCityNameByTrafficCode(loctionItem.busData?.depart, 'bus')} ì¶œë°œ</span>
                                                  </div>
                                                  <div className="schedule-arrive__info">
                                                    <div />
                                                    <span className="schedule-time__text">{loctionItem.busData?.arriveTime?.slice(0,2) + ':' + loctionItem.busData?.arriveTime?.slice(2,4)}</span>
                                                    <span className="schedule-airport__text">{getCityNameByTrafficCode(loctionItem.busData?.arrive, 'bus')} ë„ì°©</span>
                                                  </div>
                                                </div>
                                              </div>
                                            </div>
                                          </div>
                                        ) : null}
                                        {/* ì„ ë°•í¸ ë Œë”ë§ */}
                                        {loctionItem.sort === 'ship' && loctionItem.shipData ? (
                                          <div className="schedule__element__wrapper">
                                            <div className="schedule-flight__schedule__board__wrapper">
                                              <div className="schedule-flight__schedule__board">
                                                <div className="schedule-flight__info__wrapper">
                                                  <span style={{fontSize:'16px', marginRight:'10px'}}>ğŸš¢</span>
                                                  <span>{loctionItem.shipData?.shipName || '-'}</span>
                                                  <span style={{marginLeft:'10px'}}>{loctionItem.shipData?.shipCode || '-'}</span>
                                                  {loctionItem.shipData?.addDay === 'true' && (
                                                    <span style={{marginLeft:'10px', color:'#ff6b6b', fontWeight:'bold'}}>+1D</span>
                                                  )}
                                                </div>
                                                <div className="schedule-flight__time__wrapper">
                                                  <span className="schedule-flight__time">{getFlightDuration(loctionItem.shipData?.departTime, loctionItem.shipData?.arriveTime)}</span>
                                                  <div className="schedule-depart__info">
                                                    <div />
                                                    <span className="schedule-time__text">{loctionItem.shipData?.departTime?.slice(0,2) + ':' + loctionItem.shipData?.departTime?.slice(2,4)}</span>
                                                    <span className="schedule-airport__text">{getCityNameByTrafficCode(loctionItem.shipData?.depart, 'ship')} ì¶œë°œ</span>
                                                  </div>
                                                  <div className="schedule-arrive__info">
                                                    <div />
                                                    <span className="schedule-time__text">{loctionItem.shipData?.arriveTime?.slice(0,2) + ':' + loctionItem.shipData?.arriveTime?.slice(2,4)}</span>
                                                    <span className="schedule-airport__text">{getCityNameByTrafficCode(loctionItem.shipData?.arrive, 'ship')} ë„ì°©</span>
                                                  </div>
                                                </div>
                                              </div>
                                            </div>
                                          </div>
                                        ) : null}
                                        {loctionItem.sort === 'location' ? (
                                          // location íƒ€ì…ì¼ ë•Œì˜ ê¸°ì¡´ UI
                                          loctionItem.locationDetail.map((locationDetailItem:any, locationDetailIndex:number)=>{
                                            return (
                                              <div key={locationDetailIndex} className="schedule-schedule__sub_element__wrapper">
                                                <div className="schedule-schedule__element__subTitle__wrapper">
                                                  <div className="schedule-schedule__element__subTitle">
                                                    <div className="schedule-absolute__wrapper">
                                                      <div className="schedule-dot__icon" />
                                                    </div>
                                                    <div className="schedule-schedule__text__wrapper">
                                                      <span>{locationDetailItem.subLocation ? locationDetailItem.subLocation.replace(/^\[|\]$/g, '') : ''}</span>
                                                      <div className="schedule-schedule__btns">
                                                        <button className="schedule-schedule__btn" title="ë³€ê²½"
                                                          onClick={() => {
                                                          
                                                          }}>ë³€ê²½</button>
                                                      </div>
                                                    </div>
                                                  </div>
                                                </div>
                                                {/* isUseContentê°€ trueì¸ ê²½ìš° subLocationContent í‘œì‹œ */}
                                                {locationDetailItem.isUseContent && locationDetailItem.subLocationContent && (
                                                  <div style={{width:'100%', padding:'20px', marginTop:'10px', marginBottom:'10px', borderRadius:'8px'}}>
                                                    <div 
                                                      style={{
                                                        fontSize:'15px', 
                                                        lineHeight:'1.8', 
                                                        color:'#333', 
                                                        whiteSpace:'pre-wrap'
                                                      }}
                                                      dangerouslySetInnerHTML={{__html: locationDetailItem.subLocationContent}}
                                                    />
                                                  </div>
                                                )}
                                                {
                                                  locationDetailItem.subLocationDetail.map((subDetailBoxItem:any, subDetailBoxIndex:number)=>{
                                                    const shouldShowDivider = subDetailBoxIndex > 0;
                                                    return (
                                                      <div key={subDetailBoxIndex}>
                                                        {shouldShowDivider && (
                                                          <div style={{width:'100%', height:'1px', background:'#ddd', marginTop:'20px', marginBottom:'20px', borderTop:'1px dotted #999'}}></div>
                                                        )}
                                                      <div className="schedule-schedule__element__main__wrapper"
                                                          style={{width:'100%', display:'flex', flexDirection:'column', gap:'15px', padding:'30px'}}>
                                                          <div className="schedule-table__wrapper" style={{width:'100%', padding:'10px 0'}}>
                                                            <div className="schedule-table__header" style={{fontSize:'20px', fontWeight:'bold', marginBottom:'10px', color:'#000'}}>
                                                              <span>{subDetailBoxItem.locationTitle}</span>
                                                            </div>
                                                            <div className="schedule-table__main" style={{fontSize:'15px', lineHeight:'1.8', color:'#333', whiteSpace:'pre-wrap'}}
                                                              dangerouslySetInnerHTML={{__html: subDetailBoxItem.locationContent}}
                                                            />                                                
                                                          </div>
                                                          <div className="schedule-image__wrapper" style={{width:'100%', overflow:'hidden', marginTop:'8px'}}>
                                                            <div style={{
                                                              display:'flex', 
                                                              width:'100%', 
                                                              justifyContent: (subDetailBoxItem.postImages && subDetailBoxItem.postImages.length === 2) ? 'flex-start' : 'space-between',
                                                              gap: (subDetailBoxItem.postImages && subDetailBoxItem.postImages.length === 2) ? '2%' : '0'
                                                            }}>
                                                              {subDetailBoxItem.postImages && subDetailBoxItem.postImages.length > 0 ? (
                                                                subDetailBoxItem.postImages.slice(0, 3).map((imgName: string, imgIdx: number) => (
                                                                  <img
                                                                    key={imgIdx}
                                                                    style={{width:'32%', aspectRatio:'4/3', objectFit:'cover', borderRadius:'8px'}}
                                                                    src={`${AdminURL}/images/scheduledetailboximages/${imgName}`}
                                                                    onError={e => { e.currentTarget.src = ''; e.currentTarget.alt = 'ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.'; }}
                                                                  />
                                                                ))
                                                              ) : (
                                                                <span></span>
                                                              )}
                                                        </div>
                                                          </div>
                                                        </div>
                                                      </div>
                                                    )
                                                  })
                                                }
                                              </div>
                                            )
                                          })
                                        ) : null}
                                      </div>
                                    ))
                                  }
                              </div>
                              <div className="schedule-additional__schedule__wrapper">
                                <div className="schedule-index__wrapper">
                                  <span>ì‹ì‚¬</span>
                                </div>
                                <div className="schedule-additional__schedule__wrapper__textbox">
                                  <div className="schedule-meal__info__wrapper">
                                    <div className="schedule-meal__info__wrapper__text">
                                      <span>[ì¡°ì‹]</span>
                                      {editMealRowIndex === dayIndex ? (
                                        <DropdownBox
                                          widthmain="150px"
                                          height="30px"
                                          selectedValue={dayItem.breakfast || 'ì„ íƒ'}
                                          options={datmealOptions}
                                          handleChange={e => {
                                            const copy = [...scheduleList];
                                            if (copy[selectedScheduleIndex].scheduleDetailData && copy[selectedScheduleIndex].scheduleDetailData.length > 0) {
                                              copy[selectedScheduleIndex].scheduleDetailData[dayIndex].breakfast = e.target.value;
                                            }
                                            setScheduleList(copy);
                                          }}
                                        />
                                      ) : (
                                        <span style={{marginLeft:'10px'}}>{dayItem.breakfast || 'ì—†ìŒ'}</span>
                                      )}
                                    </div>
                                    <div className="schedule-meal__info__wrapper__text">
                                      <span>[ì¤‘ì‹]</span>
                                      {editMealRowIndex === dayIndex ? (
                                        <DropdownBox
                                          widthmain="150px"
                                          height="30px"
                                          selectedValue={dayItem.lunch || 'ì„ íƒ'}
                                          options={datmealOptions}
                                          handleChange={e => {
                                            const copy = [...scheduleList];
                                            if (copy[selectedScheduleIndex].scheduleDetailData && copy[selectedScheduleIndex].scheduleDetailData.length > 0) {
                                              copy[selectedScheduleIndex].scheduleDetailData[dayIndex].lunch = e.target.value;
                                            }
                                            setScheduleList(copy);
                                          }}
                                        />
                                      ) : (
                                        <span style={{marginLeft:'10px'}}>{dayItem.lunch || 'ì—†ìŒ'}</span>
                                      )}
                                    </div>
                                    <div className="schedule-meal__info__wrapper__text">
                                      <span>[ì„ì‹]</span>
                                      {editMealRowIndex === dayIndex ? (
                                        <DropdownBox
                                          widthmain="150px"
                                          height="30px"
                                          selectedValue={dayItem.dinner || 'ì„ íƒ'}
                                          options={datmealOptions}
                                          handleChange={e => {
                                            const copy = [...scheduleList];
                                            if (copy[selectedScheduleIndex].scheduleDetailData && copy[selectedScheduleIndex].scheduleDetailData.length > 0) {
                                              copy[selectedScheduleIndex].scheduleDetailData[dayIndex].dinner = e.target.value;
                                            }
                                            setScheduleList(copy);
                                          }}
                                        />
                                      ) : (
                                        <span style={{marginLeft:'10px'}}>{dayItem.dinner || 'ì—†ìŒ'}</span>
                                      )}
                                    </div>
                                  </div>
                                  <div className="schedule-additional__btn__wrapper schedule-schedule__btns">
                                    {editMealRowIndex === dayIndex ? (
                                      <button className="schedule-schedule__btn" style={{marginLeft:'8px'}} onClick={() => setEditMealRowIndex(-1)} title="ì™„ë£Œ">ì™„ë£Œ</button>
                                    ) : (
                                      <button className="schedule-schedule__btn" style={{marginLeft:'8px'}} onClick={() => setEditMealRowIndex(dayIndex)} title="ì‹ì‚¬ ë³€ê²½">ì‹ì‚¬ ë³€ê²½</button>
                                    )}
                                  </div>
                                </div>
                              </div>
                              <div className="schedule-additional__schedule__wrapper">
                                <div className="schedule-index__wrapper">
                                  {/* í˜¸í…” ì•„ì´ì½˜ ëŒ€ì²´ ê°€ëŠ¥ */}
                                  <span>í˜¸í…”</span>
                                </div>
                                <div className="schedule-additional__schedule__wrapper__textbox">
                                  <div className="schedule-additional__info__wrapper" style={{marginLeft:'0'}}>
                                      <p>{dayItem.hotel || ''}</p>
                                    <div className="schedule-additional__rating__wrapper">
                                      <RatingBoard rating={parseInt(dayItem.score) || 0} />
                                    </div>
                                  </div>
                                  <div className="schedule-additional__btn__wrapper schedule-schedule__btns">
                                    <button className="schedule-schedule__btn" title="ë³€ê²½">ë³€ê²½</button>
                                  </div>
                                </div>
                              </div>
                            </div>
                          )
                        })
                      }
                    </div>
                  )
                })
              }
            </div>
          </div>
        </div>
        
      </div>

    
           
     
      
    </div>     
  )
}
